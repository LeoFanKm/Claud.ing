# Context Engineering - AI ä»£ç†çš„ä¸Šä¸‹æ–‡å·¥ç¨‹æœ€ä½³å®è·µ

> **æ ¸å¿ƒç›®æ ‡**ï¼šæŒæ¡ Sessionsï¼ˆä¼šè¯ï¼‰ã€Memoryï¼ˆè®°å¿†ï¼‰å’Œ Context Assemblyï¼ˆä¸Šä¸‹æ–‡ç»„è£…ï¼‰çš„æœ€ä½³å®è·µï¼Œæ„å»ºæœ‰çŠ¶æ€ã€æ™ºèƒ½çš„ AI ä»£ç†

## ğŸ¯ ä½•æ—¶ä½¿ç”¨æ­¤ Skill

ä½¿ç”¨æ­¤ skill å½“ä½ éœ€è¦ï¼š

- **æ„å»ºæœ‰çŠ¶æ€çš„ AI ä»£ç†**ï¼šéœ€è¦è·¨å¤šè½®å¯¹è¯è®°ä½ä¸Šä¸‹æ–‡
- **å®ç°é•¿æœŸè®°å¿†ç³»ç»Ÿ**ï¼šè·¨ä¼šè¯ä¿å­˜å’Œæ£€ç´¢é‡è¦ä¿¡æ¯
- **ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ä½¿ç”¨**ï¼šç®¡ç†æœ‰é™çš„ä¸Šä¸‹æ–‡ç©ºé—´
- **è®¾è®¡å¤šä»£ç†ç³»ç»Ÿ**ï¼šåè°ƒå¤šä¸ª AI ä»£ç†çš„åä½œ
- **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**ï¼šç¡®ä¿æ€§èƒ½ã€å®‰å…¨å’Œå¯æ‰©å±•æ€§

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### 1. Context Engineering æ˜¯ä»€ä¹ˆï¼Ÿ

**Context Engineeringï¼ˆä¸Šä¸‹æ–‡å·¥ç¨‹ï¼‰** æ˜¯åŠ¨æ€ç»„è£…å’Œç®¡ç† LLM ä¸Šä¸‹æ–‡çª—å£ä¸­ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œç›®æ ‡æ˜¯è®© AI ä»£ç†å…·å¤‡ï¼š

- **æœ‰çŠ¶æ€æ€§**ï¼šè·¨å¯¹è¯è½®æ¬¡ä¿æŒçŠ¶æ€
- **è®°å¿†èƒ½åŠ›**ï¼šé•¿æœŸä¿å­˜å’Œæ£€ç´¢å…³é”®ä¿¡æ¯
- **æ™ºèƒ½å†³ç­–**ï¼šåŸºäºå†å²å’Œè®°å¿†åšå‡ºæ›´å¥½çš„å†³ç­–

### 2. ä¸‰å¤§æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Engineering                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Sessions   â”‚  â”‚    Memory    â”‚  â”‚   Context    â”‚     â”‚
â”‚  â”‚   (ä¼šè¯)     â”‚  â”‚   (è®°å¿†)     â”‚  â”‚   Assembly   â”‚     â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   (ç»„è£…)     â”‚     â”‚
â”‚  â”‚ â€¢ å¯¹è¯å†å²   â”‚  â”‚ â€¢ é•¿æœŸå­˜å‚¨   â”‚  â”‚ â€¢ åŠ¨æ€åŠ è½½   â”‚     â”‚
â”‚  â”‚ â€¢ å·¥ä½œè®°å¿†   â”‚  â”‚ â€¢ è·¨ä¼šè¯     â”‚  â”‚ â€¢ ä¼˜å…ˆçº§     â”‚     â”‚
â”‚  â”‚ â€¢ äº‹ä»¶æµ     â”‚  â”‚ â€¢ æå–æ•´åˆ   â”‚  â”‚ â€¢ å‹ç¼©ç­–ç•¥   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Sessionsï¼ˆä¼šè¯ï¼‰

**å®šä¹‰**ï¼šå•æ¬¡å¯¹è¯çš„å®¹å™¨ï¼ŒåŒ…å«ï¼š
- **Eventsï¼ˆäº‹ä»¶ï¼‰**ï¼šç”¨æˆ·è¾“å…¥ã€ä»£ç†å“åº”ã€å·¥å…·è°ƒç”¨ã€å·¥å…·è¾“å‡º
- **Stateï¼ˆçŠ¶æ€ï¼‰**ï¼šä»£ç†çš„å·¥ä½œè®°å¿†

**å…³é”®ç‰¹æ€§**ï¼š
- æŒ‰æ—¶é—´é¡ºåºè®°å½•å¯¹è¯å†å²
- ç»´æŠ¤å½“å‰ä¼šè¯çš„å·¥ä½œçŠ¶æ€
- æ”¯æŒå‹ç¼©ç­–ç•¥ï¼ˆæˆªæ–­ã€æ‘˜è¦ï¼‰

#### Memoryï¼ˆè®°å¿†ï¼‰

**å®šä¹‰**ï¼šè·¨ä¼šè¯çš„é•¿æœŸæŒä¹…åŒ–æœºåˆ¶

**ä¸¤ç§ç±»å‹**ï¼š
- **Declarative Memoryï¼ˆé™ˆè¿°æ€§è®°å¿†ï¼‰**ï¼š"knowing what" - äº‹å®ã€åå¥½ã€ç”¨æˆ·ä¿¡æ¯
- **Procedural Memoryï¼ˆç¨‹åºæ€§è®°å¿†ï¼‰**ï¼š"knowing how" - å·¥ä½œæµç¨‹ã€ç­–ç•¥ã€æ”¹è¿›æ–¹æ³•

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
æå– â†’ æ•´åˆ â†’ å­˜å‚¨ â†’ æ£€ç´¢
(Extraction) â†’ (Consolidation) â†’ (Storage) â†’ (Retrieval)
```

#### Context Assemblyï¼ˆä¸Šä¸‹æ–‡ç»„è£…ï¼‰

**å®šä¹‰**ï¼šå°† Sessions å’Œ Memory åŠ¨æ€ç»„åˆåˆ°ä¸Šä¸‹æ–‡çª—å£

**æ ¸å¿ƒä»»åŠ¡**ï¼š
- åŠ è½½ç›¸å…³çš„å†å²äº‹ä»¶
- æ£€ç´¢åŒ¹é…çš„è®°å¿†
- åº”ç”¨å‹ç¼©ç­–ç•¥
- ä¼˜åŒ– token ä½¿ç”¨

### 3. Memory vs RAG çš„åŒºåˆ«

| ç»´åº¦ | Memoryï¼ˆè®°å¿†ï¼‰ | RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ |
|-----|---------------|-------------------|
| **ç›®æ ‡** | è®©ä»£ç†æˆä¸º"ç”¨æˆ·ä¸“å®¶" | è®©ä»£ç†æˆä¸º"äº‹å®ä¸“å®¶" |
| **å†…å®¹** | ç”¨æˆ·åå¥½ã€å†å²ã€çŠ¶æ€ | æ–‡æ¡£ã€çŸ¥è¯†åº“ã€å…¬å¼€ä¿¡æ¯ |
| **æ›´æ–°** | åŠ¨æ€æ›´æ–°ï¼ˆå¯¹è¯ä¸­ï¼‰ | ç›¸å¯¹é™æ€ï¼ˆå®šæœŸæ›´æ–°ï¼‰ |
| **ä¸ªæ€§åŒ–** | é«˜åº¦ä¸ªæ€§åŒ– | é€šç”¨çŸ¥è¯† |
| **ç¤ºä¾‹** | "ç”¨æˆ·å–œæ¬¢ç®€æ´å›ç­”" | "Python çš„æœ€æ–°è¯­æ³•" |

**ç»“åˆä½¿ç”¨**ï¼š
- Memoryï¼šäº†è§£ç”¨æˆ·ä¸ªäººæƒ…å†µ
- RAGï¼šæä¾›ä¸“ä¸šçŸ¥è¯†æ”¯æŒ

## ğŸ—ï¸ æ¶æ„æ¨¡å¼

### 1. Memory å­˜å‚¨æ¶æ„

#### Vector Databaseï¼ˆå‘é‡æ•°æ®åº“ï¼‰
```
ä¼˜ç‚¹ï¼šè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢
é€‚åˆï¼šéç»“æ„åŒ–è®°å¿†ï¼ˆè‡ªç„¶è¯­è¨€æè¿°ï¼‰
ç¤ºä¾‹ï¼šPinecone, Weaviate, ChromaDB
```

#### Knowledge Graphï¼ˆçŸ¥è¯†å›¾è°±ï¼‰
```
ä¼˜ç‚¹ï¼šå…³ç³»æŸ¥è¯¢ã€æ¨ç†èƒ½åŠ›
é€‚åˆï¼šç»“æ„åŒ–è®°å¿†ï¼ˆå®ä½“å…³ç³»ï¼‰
ç¤ºä¾‹ï¼šNeo4j, Amazon Neptune
```

#### Hybridï¼ˆæ··åˆæ¶æ„ï¼‰
```
ä¼˜ç‚¹ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿
é€‚åˆï¼šå¤æ‚åº”ç”¨åœºæ™¯
ç¤ºä¾‹ï¼šVector DB + Knowledge Graph
```

### 2. Memory æ£€ç´¢ç­–ç•¥

#### Proactiveï¼ˆä¸»åŠ¨åŠ è½½ï¼‰
```python
# æ¯æ¬¡å¯¹è¯å¼€å§‹æ—¶è‡ªåŠ¨åŠ è½½è®°å¿†
def start_session(user_id):
    memories = load_memories(user_id)
    context = build_context(memories)
    return context
```

**ä¼˜ç‚¹**ï¼šç®€å•ã€ä¸€è‡´
**ç¼ºç‚¹**ï¼šå¯èƒ½åŠ è½½ä¸ç›¸å…³ä¿¡æ¯

#### Reactiveï¼ˆMemory-as-a-Toolï¼‰
```python
# è®©ä»£ç†å†³å®šä½•æ—¶æŸ¥è¯¢è®°å¿†
tools = [
    {
        "name": "retrieve_memory",
        "description": "Search user's long-term memory"
    }
]
```

**ä¼˜ç‚¹**ï¼šçµæ´»ã€é«˜æ•ˆ
**ç¼ºç‚¹**ï¼šéœ€è¦ä»£ç†ä¸»åŠ¨è°ƒç”¨

### 3. Multi-Agent åä½œæ¨¡å¼

#### Unified Historyï¼ˆç»Ÿä¸€å†å²ï¼‰
```
æ‰€æœ‰ä»£ç†å…±äº«åŒä¸€ä¸ª Session
ä¼˜ç‚¹ï¼šå®Œæ•´ä¸Šä¸‹æ–‡ã€åä½œç´§å¯†
ç¼ºç‚¹ï¼šéšç§é£é™©ã€ä¸Šä¸‹æ–‡æ±¡æŸ“
```

#### Separate Historiesï¼ˆç‹¬ç«‹å†å²ï¼‰
```
æ¯ä¸ªä»£ç†ç»´æŠ¤è‡ªå·±çš„ Session
ä¼˜ç‚¹ï¼šéšç§ä¿æŠ¤ã€æ¸…æ™°è¾¹ç•Œ
ç¼ºç‚¹ï¼šéœ€è¦æ˜¾å¼åŒæ­¥æœºåˆ¶
```

## ğŸ”‘ æœ€ä½³å®è·µ

### 1. Session ç®¡ç†

âœ… **åš**ï¼š
- å®šæœŸå‹ç¼©é•¿å¯¹è¯ï¼ˆæ‘˜è¦ã€æˆªæ–­ï¼‰
- ä¿ç•™é‡è¦äº‹ä»¶ï¼ˆç”¨æˆ·æ˜ç¡®è¦æ±‚ã€å…³é”®å†³ç­–ï¼‰
- ä½¿ç”¨ç»“æ„åŒ–çŠ¶æ€ï¼ˆJSONã€å­—å…¸ï¼‰

âŒ **ä¸åš**ï¼š
- æ— é™å¢é•¿ Sessionï¼ˆè¶…å‡ºä¸Šä¸‹æ–‡çª—å£ï¼‰
- ä¸¢å¤±ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿å­˜çš„ä¿¡æ¯
- æ··æ·†ä¸åŒç”¨æˆ·çš„ Session

### 2. Memory æå–

âœ… **åš**ï¼š
- ä½¿ç”¨ LLM æ™ºèƒ½è¿‡æ»¤ï¼ˆå®šä¹‰ä¸»é¢˜ï¼‰
- æå–å¯æ“ä½œçš„ä¿¡æ¯ï¼ˆåå¥½ã€å·¥ä½œæµç¨‹ï¼‰
- æ ‡è®°è®°å¿†æ¥æºï¼ˆprovenance trackingï¼‰

âŒ **ä¸åš**ï¼š
- ä¿å­˜æ‰€æœ‰å¯¹è¯å†…å®¹ï¼ˆæµªè´¹å­˜å‚¨ï¼‰
- æå–çç¢ä¿¡æ¯ï¼ˆå¤©æ°”èŠå¤©ï¼‰
- å¿½ç•¥è®°å¿†æ–°é²œåº¦ï¼ˆè¿‡æ—¶ä¿¡æ¯ï¼‰

### 3. Memory æ•´åˆ

âœ… **åš**ï¼š
- åˆå¹¶é‡å¤è®°å¿†
- æ›´æ–°å†²çªè®°å¿†ï¼ˆä¿ç•™æœ€æ–°ï¼‰
- åˆ é™¤è¿‡æ—¶è®°å¿†

âŒ **ä¸åš**ï¼š
- æ— é™ç´¯ç§¯è®°å¿†ï¼ˆå†…å­˜çˆ†ç‚¸ï¼‰
- å¿½ç•¥çŸ›ç›¾ä¿¡æ¯ï¼ˆç”¨æˆ·åå¥½æ”¹å˜ï¼‰
- ä¿ç•™æ•æ„Ÿä¿¡æ¯ï¼ˆPII æœªå¤„ç†ï¼‰

## ğŸ› ï¸ å¿«é€Ÿä¸Šæ‰‹

### åŸºç¡€ç¤ºä¾‹ï¼šMulti-turn å¯¹è¯ï¼ˆGemini APIï¼‰

```python
from google import genai

client = genai.Client(api_key='YOUR_API_KEY')

# åˆå§‹åŒ–ä¼šè¯å†å²
contents = []

# ç¬¬ä¸€è½®å¯¹è¯
contents.append({
    "role": "user",
    "parts": [{"text": "What is the capital of France?"}]
})

response = client.models.generate_content(
    model="gemini-2.5-flash",
    contents=contents
)

# æ·»åŠ æ¨¡å‹å“åº”
contents.append({
    "role": "model",
    "parts": [{"text": response.text}]
})

# ç¬¬äºŒè½®å¯¹è¯ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰
contents.append({
    "role": "user",
    "parts": [{"text": "What is its population?"}]
})

response = client.models.generate_content(
    model="gemini-2.5-flash",
    contents=contents
)
```

### è¿›é˜¶ç¤ºä¾‹ï¼šMemory ç”Ÿæˆï¼ˆADK Memory Bankï¼‰

```python
from google.adk.agent_engine import AgentEngine

client = genai.Client()

# å¼‚æ­¥ç”Ÿæˆè®°å¿†ï¼ˆåå°å¤„ç†ï¼‰
client.agent_engines.memories.generate(
    name=f"agent-engines/{agent_engine_name}",
    scope={"user_id": user_id},
    direct_contents_source={
        "events": [
            {"user_input": "I prefer concise answers"},
            {"agent_response": "Understood, I'll keep responses brief"}
        ]
    },
    config={"wait_for_completion": False}  # åå°å¼‚æ­¥
)

# æ£€ç´¢è®°å¿†
memories = client.agent_engines.memories.list(
    name=f"agent-engines/{agent_engine_name}",
    scope={"user_id": user_id}
)
```

## ğŸ“– æ·±å…¥å­¦ä¹ 

- **[Sessions è¯¦ç»†æŒ‡å—](./sessions-guide.md)** - äº‹ä»¶å¤„ç†ã€çŠ¶æ€ç®¡ç†ã€å‹ç¼©ç­–ç•¥
- **[Memory è¯¦ç»†æŒ‡å—](./memory-guide.md)** - æå–ã€æ•´åˆã€æ£€ç´¢ã€ç»„ç»‡æ¨¡å¼
- **[ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•](./production-checklist.md)** - å®‰å…¨ã€æ€§èƒ½ã€å¯æ‰©å±•æ€§

## ğŸŒŸ å…³é”®è¦ç‚¹

1. **Context Engineering = Sessions + Memory + Context Assembly**
2. **Sessions ç®¡ç†å½“å‰å¯¹è¯ï¼ŒMemory è·¨è¶Šä¼šè¯**
3. **Memory â‰  RAG**ï¼šMemory äº†è§£ç”¨æˆ·ï¼ŒRAG äº†è§£çŸ¥è¯†
4. **å¼‚æ­¥å¤„ç†**ï¼šMemory ç”Ÿæˆåº”åœ¨åå°è¿›è¡Œ
5. **Provenance Tracking**ï¼šè®°å½•è®°å¿†æ¥æºï¼Œåˆ¤æ–­å¯ä¿¡åº¦
6. **å®‰å…¨ä¼˜å…ˆ**ï¼šPII å¤„ç†ã€æ•°æ®éš”ç¦»ã€é˜²æ­¢è®°å¿†æŠ•æ¯’

## ğŸ’¡ å¸¸è§åœºæ™¯

| åœºæ™¯ | ä½¿ç”¨ç»„ä»¶ | ç­–ç•¥ |
|-----|---------|------|
| å®¢æœèŠå¤©æœºå™¨äºº | Sessions + Memory | Proactive åŠ è½½ç”¨æˆ·å†å² |
| ä»£ç åŠ©æ‰‹ | Sessions + RAG | Memory å­˜å‚¨ç”¨æˆ·ä»£ç é£æ ¼ |
| ä¸ªäººåŠ©ç† | Sessions + Memory | Procedural Memory å­˜å‚¨å·¥ä½œæµç¨‹ |
| å¤šä»£ç†åä½œ | Unified/Separate Sessions | æ ¹æ®éšç§éœ€æ±‚é€‰æ‹© |
| é•¿å¯¹è¯ | Session Compression | æ‘˜è¦ + ä¿ç•™å…³é”®äº‹ä»¶ |

---

**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæ·±å…¥å­¦ä¹  [Sessions](./sessions-guide.md)ã€[Memory](./memory-guide.md) æˆ– [ç”Ÿäº§æ£€æŸ¥æ¸…å•](./production-checklist.md)ã€‚
